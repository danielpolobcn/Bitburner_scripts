var serversMoney = [];
var serversRich = [];

// List all the servers with 0 ports to open connected to "home", and choose the server with the most money as target.
var servers = scan("home");
for (i in servers) {
	if (getServerNumPortsRequired(servers[i]) == 0) {
		var MaxMoney = getServerMaxMoney(servers[i]);
		serversMoney.push(MaxMoney);
		serversRich.push(servers[i]);
	} 
}
var Max = Math.max.apply(null, serversMoney);
var position = serversMoney.indexOf(Max);
var target = serversRich[position];
tprint ("Target server = " , target);

// Crack and self-hack the target server.
var ramPerThread = getScriptRam("basic-hack.script");
scp("basic-hack.script" , target);
brutessh(target);
nuke(target);
var ramAvailable = getServerMaxRam(target) - getServerUsedRam(target);
var threads = Math.floor(ramAvailable / ramPerThread);
exec("basic-hack.script" , target , threads, target);

// Remove the target server from the array of servers found.
for(var i = 0; i < servers.length; i++){ 
    if (servers[i] === target){ 
        servers.splice(i, 1);
		i--; 
    }
}

// Launch the hacking script against the target server in all the servers found, with as many threads as allowed by their RAM.
for (j in servers){
	if (getServerNumPortsRequired(servers[j]) == 0) {
		sleep (1000);
		scp("basic-hack.script" , servers[j]);
		nuke(servers[j]);
		var ramAvailable = getServerMaxRam(servers[j]) - getServerUsedRam(servers[j]);
		var threads = Math.floor(ramAvailable / ramPerThread);
		exec("basic-hack.script" , servers[j] , threads, target);
	}
}